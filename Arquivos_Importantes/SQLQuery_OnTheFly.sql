/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*------------------------------------------------------------------PROJ_On_The_FLY----------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
CREATE DATABASE OnTheFly;--------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
USE OnTheFly;--------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
CREATE TABLE Destino
	(
		IATA VARCHAR (3) NOT NULL,

		CONSTRAINT IATA PRIMARY KEY (IATA)
	);
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
CREATE TABLE Passageiro 
	(
		CPF VARCHAR (11) NOT NULL,
		Situacao VARCHAR (7) DEFAULT 'ATIVO',		--->Ativo || --->Inativo
		Sexo VARCHAR (15) NOT NULL,
		Nome VARCHAR (50) NOT NULL,
		Data_Cadastro DATETIME NOT NULL,	-- NO PRIMEIRO INSERT (CADASTRO) SERA A DATA DO SISTEMA
		Data_Nascimento DATE NOT NULL,	
		Data_Ultima_Compra DATETIME NOT NULL,
		
		CONSTRAINT CPF PRIMARY KEY (CPF)
	);
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
CREATE TABLE CompanhiaAerea
	(
		CNPJ VARCHAR (14) NOT NULL,
		Razao_Social VARCHAR(50) NOT NULL,
		Data_Cadastro DATETIME NOT NULL,	-- NO PRIMEIRO INSERT (CADASTRO) SERA A DATA DO SISTEMA
		Data_Abertura DATE NOT NULL,
		Ultimo_Voo DATETIME NOT NULL,		-- NO PRIMEIRO INSERT (CADASTRO) SERA A DATA DO SISTEMA
		Situacao VARCHAR (7) DEFAULT 'ATIVO',		--->Ativo || --->Inativo

		CONSTRAINT CNPJ PRIMARY KEY (CNPJ)
	);


/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
CREATE TABLE Aeronave
	(
		INSCRICAO VARCHAR(6) NOT NULL,
		CNPJ VARCHAR(14) NOT NULL,
		Capacidade INT NOT NULL,
		Ultima_Venda DATETIME NOT NULL,		-- NO PRIMEIRO INSERT (CADASTRO) SERA A DATA DO SISTEMA
		Situacao VARCHAR (7) DEFAULT 'ATIVO',		--->Ativo || --->Inativo
		Data_Cadastro DATETIME NOT NULL,	-- NO PRIMEIRO INSERT (CADASTRO) SERA A DATA DO SISTEMA

		CONSTRAINT INSCRICAO PRIMARY KEY (INSCRICAO),
		FOREIGN KEY (CNPJ) REFERENCES CompanhiaAerea (CNPJ)
	);
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
CREATE TABLE Voo
	(
		ID_VOO VARCHAR (5) NOT NULL,
		INSCRICAO VARCHAR (6) NOT NULL,
		Situacao VARCHAR (7) DEFAULT 'ATIVO',		--->Ativo || --->Inativo
		IATA VARCHAR (3) NOT NULL,
		Data_Cadastro DATETIME NOT NULL,	-- NO PRIMEIRO INSERT (CADASTRO) SERA A DATA DO SISTEMA
		Data_Hora_Voo DATETIME NOT NULL,
		Assentos_Ocupados INT DEFAULT 0,

		CONSTRAINT ID_VOO PRIMARY KEY (ID_Voo),
		FOREIGN KEY (INSCRICAO) REFERENCES Aeronave (INSCRICAO),
		FOREIGN KEY (IATA) REFERENCES Destino (IATA)
	);
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
CREATE TABLE Passagem
	(
		ID_PASSAGEM VARCHAR (6) NOT NULL,
		ID_VOO VARCHAR (5) NOT NULL,
		--ID_VENDA INT NO NULL,
		Valor FLOAT NOT NULL,
		Situacao VARCHAR (9) DEFAULT 'LIVRE',		--->LIVRE || --->RESERVADA || --->PAGA
		Data_Cadastro DATETIME NOT NULL,	-- NO PRIMEIRO INSERT (CADASTRO) SERA A DATA DO SISTEMA 
		Data_Ultima_Operacao DATETIME NOT NULL,

		CONSTRAINT ID_PASSAGEM PRIMARY KEY (ID_PASSAGEM, ID_VOO),
		FOREIGN KEY (ID_VOO) REFERENCES Voo (ID_VOO),
	);
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
CREATE TABLE Venda
	(
		ID_VENDA INT IDENTITY NOT NULL,
		CPF VARCHAR (11) NOT NULL,
		Data_Venda DATETIME NOT NULL,
		Valor_Total FLOAT NOT NULL,

		CONSTRAINT PK_ID_VENDA PRIMARY KEY (ID_VENDA),
		FOREIGN KEY (CPF) REFERENCES Passageiro (CPF)
	);
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
CREATE TABLE ItemVenda
	(
		ID_ITEM_VENDA INT IDENTITY NOT NULL,
		ID_PASSAGEM VARCHAR (6) NOT NULL,
		ID_VOO VARCHAR (5) NOT NULL,
		ID_VENDA INT NOT NULL,
		Valor_Unitario FLOAT NOT NULL,
		CONSTRAINT ID_ITEM_VENDA PRIMARY KEY (ID_ITEM_VENDA),
		CONSTRAINT FK_ID_PASSAGEM FOREIGN KEY (ID_PASSAGEM, ID_VOO) REFERENCES Passagem(ID_PASSAGEM, ID_VOO),
		FOREIGN KEY (ID_VENDA) REFERENCES Venda(ID_VENDA)
	);
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
CREATE TABLE Restritos
 (
	CPF_RESTRITO VARCHAR (11)

	CONSTRAINT CPF_RESTRITO PRIMARY KEY (CPF_RESTRITO)
 );
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
CREATE TABLE Bloqueados
 (
	CNPJ_RESTRITO VARCHAR (14)

	CONSTRAINT CNPJ_RESTRITO PRIMARY KEY (CNPJ_RESTRITO)
 );
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*---------------------------------------------------------------------ABAIXO:---------------------------------------------------------------------------------------*/
/*---------------------------------------------------CODIGOS--USADOS--PARA--TESTES--DURANTE--PRODUÇÃO----------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--	insert into CompanhiaAerea(CNPJ, Razao_Social, Data_Cadastro, Ultimo_Voo, Data_Abertura)
--	values ('1', 'ATRACSS', '28/08/2022', '28/08/2022', '11/05/2002');
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--SELECT CompanhiaAerea.CNPJ, CompanhiaAerea.Razao_Social, Aeronave.INSCRICAO, Aeronave.Capacidade, Aeronave.Situacao
--	FROM Aeronave
--	RIGHT JOIN CompanhiaAerea
--	ON(CompanhiaAerea.CNPJ = Aeronave.CNPJ)
	
--	WHERE CompanhiaAerea.CNPJ = 78314017000100;

--	insert into Destino 
--	values ('CGH');
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

--	SELECT Capacidade FROM Aeronave WHERE Inscricao = 'PH-ASS';
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

--	SELECT Situacao = 'ATIVA' AND CNPJ  FROM CompanhiaAerea WHERE Situacao = 'ATIVA' AND CNPJ  = '78314017000100'
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--	SELECT CompanhiaAerea.Razao_Social, Voo.ID_VOO, Voo.Situacao, Voo.Data_Hora_Voo, Voo.Assentos_Ocupados, Aeronave.INSCRICAO
--	FROM Aeronave
--	RIGHT JOIN CompanhiaAerea
--	ON(CompanhiaAerea.CNPJ = Aeronave.CNPJ)
--	RIGHT JOIN Voo
--	ON(Voo.INSCRICAO = Aeronave.INSCRICAO)
	
--	WHERE CompanhiaAerea.CNPJ = 60171874000133;
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--	update Passagem
--	set Valor = 180.95
--	where ID_PASSAGEM = 'PA1078';
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--	SELECT CompanhiaAerea.Razao_Social, Voo.ID_VOO, Voo.Situacao, Voo.Data_Hora_Voo, Voo.Assentos_Ocupados, Aeronave.INSCRICAO 
--                             FROM Aeronave 
--                             RIGHT JOIN CompanhiaAerea 
--                             ON(CompanhiaAerea.CNPJ = Aeronave.CNPJ) 
--                             RIGHT JOIN Voo 
--                             ON(Voo.INSCRICAO = Aeronave.INSCRICAO) 
--                             WHERE Voo.Situacao = 'ATIVO';
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--UPDATE Voo SET Situacao = 'ATIVO' WHERE ID_VOO = 'V5307';
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--insert into restritos 
--values ('48863004817'),
--	   ('12345678944'),
--	   ('47863220014');
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--	   SELECT COUNT (Situacao) FROM Passagem WHERE ID_VOO = 'V5307';
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--	   DELETE FROM Restritos WHERE CPF_RESTRITO = '47931004817';
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--DROP TABLE Restritos;
--DROP TABLE Bloqueados;
--DROP TABLE ItemVenda;
--DROP TABLE Passagem;
--DROP TABLE Venda;
--DROP TABLE Passageiro;
--DROP TABLE CompanhiaAerea;
--DROP TABLE Aeronave;
--DROP TABLE Voo;
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--SELECT * FROM Passageiro;
--SELECT * FROM CompanhiaAerea;
--SELECT * FROM Aeronave;
--SELECT * FROM Voo;
--SELECT * FROM Passagem where id_voo = 'v8830';
--SELECT * FROM Venda;
--SELECT * FROM ItemVenda;
--SELECT * FROM Destino;
--SELECT * FROM Restritos;
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--DELETE CNPJ FROM Aeronave WHERE INSCRICAO = '{inscricao}';
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
--/*-------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
